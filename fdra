#!/usr/bin/python2 -S
# -*- coding: utf-8 -*-
import sys
sys.setdefaultencoding("utf-8")
import site
import traceback

# 工具入口


import parser 
from parser import report_parser

def print_usage( argv0 = 'fdra'):
    print "Usage:"
    print "  %s import <日报文件>   解析导入逐日盯市日报文件" % argv0
    print "  %s stat                显示统计"         % argv0

# 处理 'import' 子命令
def handle_import( argv):
    i = len(argv)
    if ( i < 1 ):
        print "  %s import <日报文件>     解析导入日报文件" % sys.argv[0]
        print "\n 未指定 <日报文件>\n"
        return 1

    try:

        s = report_parser.parse_single_file( argv[0]  )

        report_parser.save_report_to_db(s)

    except  Exception as e:
         (t, v, bt) = sys.exc_info()
         #print e
         traceback.print_exception(t, v, bt)

         return 2

    #s.dump()

    return 0

# 处理 'stat' 子命令
def handle_stat():
    print "not implemented yet."
    return 0

def main():

    i = len(sys.argv)
    if ( i < 2 ):
        print_usage()
        return 1

    sub_command = sys.argv[1]

    if ('import' == sub_command ):
        return handle_import ( sys.argv[2:] ) 
    if ('stat' == sub_command ):
        return handle_stat( )
    elif ('help' == sub_command ):
        print_usage()
        return 1
    else:
        print "\n无效的‘子命令’ -- %s\n" % ( sub_command, )
        print_usage()
        return 1

    return 0


if __name__ == "__main__":
    r = main()
    sys.exit(r)


